â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                                â•‘
â•‘        ğŸ” CONFIGURACIÃ“N DE PERMISOS IAM PARA AWS ACTUALIZADA ğŸ”               â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… ARCHIVOS ACTUALIZADOS:

ğŸ” IAM & Seguridad:
   â”œâ”€ setup-iam.ps1                 â†’ Script automÃ¡tico para crear rol y polÃ­tica
   â”œâ”€ IAM_SETUP_GUIDE.md           â†’ GuÃ­a completa de configuraciÃ³n IAM
   â””â”€ .env.example                  â†’ Actualizado (NO usar AWS_ACCESS_KEY_ID)

ğŸ”§ Scripts actualizados:
   â”œâ”€ create-apprunner-service.ps1 â†’ Ahora incluye rol IAM automÃ¡ticamente
   â””â”€ STEP_BY_STEP.md              â†’ Actualizado con paso de IAM

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ TU APLICACIÃ“N USA LOS SIGUIENTES SERVICIOS AWS:

âœ… Amazon Rekognition:
   â€¢ DetectFaces - Reconocimiento facial
   â€¢ IndexFaces - Indexar caras en colecciÃ³n
   â€¢ SearchFacesByImage - Buscar rostros conocidos
   â€¢ DetectText - Detectar texto en placas de vehÃ­culos
   â€¢ DetectCustomLabels - Comportamiento sospechoso
   â€¢ Proyecto: ComportamientoSospechoso

âœ… Amazon S3:
   â€¢ GetObject - Leer imÃ¡genes
   â€¢ PutObject - Guardar imÃ¡genes
   â€¢ DeleteObject - Eliminar imÃ¡genes
   â€¢ ListBucket - Listar contenido

âœ… Amazon Textract:
   â€¢ DetectDocumentText - OCR de documentos
   â€¢ AnalyzeDocument - AnÃ¡lisis de documentos
   â€¢ AnalyzeID - AnÃ¡lisis de identificaciones

âœ… Amazon ECR:
   â€¢ Pull de imÃ¡genes Docker

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸš€ PROCESO ACTUALIZADO (AHORA CON IAM):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 1: Configurar IAM (NUEVO - REQUERIDO)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Ejecuta el script automÃ¡tico:
   > .\setup-iam.ps1

   Esto crearÃ¡:
   âœ… PolÃ­tica: CondominiumBackendPolicy
   âœ… Rol: CondominiumAppRunnerTaskRole
   âœ… Permisos: Rekognition + S3 + Textract + ECR

   âš ï¸ IMPORTANTE: NO configures AWS_ACCESS_KEY_ID en variables de entorno
   El rol IAM proveerÃ¡ las credenciales automÃ¡ticamente y es mÃ¡s seguro.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 2: Subir imagen a ECR                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   > .\deploy-to-ecr.ps1

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 3: Crear servicio en App Runner                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   > .\create-apprunner-service.ps1

   El script ahora:
   âœ… Verifica que el rol IAM existe
   âœ… Asigna el rol automÃ¡ticamente al servicio
   âœ… Configura AWS_DEFAULT_REGION
   âœ… NO configura AWS_ACCESS_KEY_ID (usa el rol)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” SEGURIDAD - MEJORES PRÃCTICAS:

âœ… HACER:
   â€¢ Usar roles IAM (mÃ¡s seguro que access keys)
   â€¢ Configurar AWS_DEFAULT_REGION
   â€¢ Limitar permisos S3 a buckets especÃ­ficos (opcional)
   â€¢ Revisar logs de CloudWatch
   â€¢ Rotar credenciales de RDS regularmente

âŒ NO HACER:
   â€¢ NO configurar AWS_ACCESS_KEY_ID en variables de entorno
   â€¢ NO configurar AWS_SECRET_ACCESS_KEY en variables de entorno
   â€¢ NO hacer commit de credenciales en Git
   â€¢ NO usar permisos * en producciÃ³n (solo para desarrollo)
   â€¢ NO dejar DEBUG=True en producciÃ³n

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ§ª VERIFICAR QUE TODO FUNCIONA:

DespuÃ©s del despliegue, prueba estos endpoints:

1. Health Check:
   curl https://tu-app.awsapprunner.com/health/
   âœ… Debe responder: {"status": "healthy"}

2. Swagger UI:
   https://tu-app.awsapprunner.com/api/docs/
   âœ… Debe mostrar la documentaciÃ³n

3. Probar reconocimiento facial:
   POST https://tu-app.awsapprunner.com/api/ai/faces/search
   âœ… Si falla con "Access Denied", verifica el rol IAM

4. Revisar logs:
   Ve a CloudWatch â†’ Log Groups â†’ /aws/apprunner/...
   âœ… NO debe haber errores de credenciales

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’° COSTOS ADICIONALES CON ESTOS SERVICIOS:

AdemÃ¡s del costo de App Runner (~$56/mes):

ğŸ“Š Amazon Rekognition:
   â€¢ DetectFaces: $0.001 por imagen
   â€¢ IndexFaces: $0.001 por imagen
   â€¢ SearchFaces: $0.001 por bÃºsqueda
   â€¢ DetectText: $0.001 por imagen
   â€¢ Custom Labels: $4/hora modelo activo + $0.01 por imagen
   Ejemplo: 10,000 imÃ¡genes/mes â‰ˆ $10

ğŸ“¦ Amazon S3:
   â€¢ Almacenamiento: $0.023 por GB/mes
   â€¢ PUT/POST: $0.005 por 1,000 requests
   â€¢ GET: $0.0004 por 1,000 requests
   Ejemplo: 10GB + 50,000 requests â‰ˆ $0.50/mes

ğŸ“„ Amazon Textract:
   â€¢ DetectDocumentText: $1.50 por 1,000 pÃ¡ginas
   â€¢ AnalyzeDocument: $50 por 1,000 pÃ¡ginas
   Ejemplo: 1,000 pÃ¡ginas/mes â‰ˆ $1.50

ğŸ’¾ Amazon RDS PostgreSQL:
   â€¢ SegÃºn tu instancia actual
   â€¢ db.t3.micro: ~$15/mes
   â€¢ db.t3.small: ~$30/mes

ğŸ”„ Transfer de datos:
   â€¢ Primeros 100GB/mes: GRATIS
   â€¢ DespuÃ©s: $0.09 por GB

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“š DOCUMENTACIÃ“N DE REFERENCIA:

â€¢ IAM_SETUP_GUIDE.md     - GuÃ­a completa de IAM (manual)
â€¢ STEP_BY_STEP.md        - Proceso completo actualizado
â€¢ setup-iam.ps1          - Script automÃ¡tico de IAM

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ†˜ TROUBLESHOOTING IAM:

âŒ Error: "Access Denied" en Rekognition
   âœ Verifica: aws iam get-role --role-name CondominiumAppRunnerTaskRole
   âœ Verifica: El rol estÃ¡ asignado en App Runner
   âœ SoluciÃ³n: .\setup-iam.ps1

âŒ Error: "Credentials not found"
   âœ Causa: Variables AWS_ACCESS_KEY_ID configuradas
   âœ SoluciÃ³n: Elimina esas variables de App Runner

âŒ Error: "Invalid bucket name"
   âœ Verifica: El bucket S3 existe
   âœ Verifica: El rol tiene permisos s3:GetObject

âŒ Error: "Model not found" (Custom Labels)
   âœ Verifica: PROJECT_VERSION_ARN en rekognition_service.py
   âœ Verifica: El modelo estÃ¡ iniciado en Rekognition

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… CHECKLIST FINAL:

- [ ] .\setup-iam.ps1 ejecutado exitosamente
- [ ] PolÃ­tica CondominiumBackendPolicy creada
- [ ] Rol CondominiumAppRunnerTaskRole creado
- [ ] .\deploy-to-ecr.ps1 ejecutado exitosamente
- [ ] Imagen Docker en ECR
- [ ] .\create-apprunner-service.ps1 ejecutado exitosamente
- [ ] Servicio App Runner creado
- [ ] Rol IAM asignado al servicio
- [ ] Variables de entorno configuradas (sin AWS_ACCESS_KEY_ID)
- [ ] Health check responde 200 OK
- [ ] Swagger UI accesible
- [ ] Pruebas de Rekognition funcionan
- [ ] Logs sin errores de permisos

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‰ Â¡TODO LISTO! Tu backend estÃ¡ configurado con permisos seguros para AWS.

Los servicios de IA (Rekognition, Textract) funcionarÃ¡n automÃ¡ticamente usando
el rol IAM sin necesidad de credenciales hardcodeadas. ğŸš€

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
